<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encuesta de Hábitos de Consumo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-image: url('habitosconsumo.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .overlay {
            background-color: rgba(0, 0, 0, 0.6);
            padding: 3rem;
            border-radius: 10px;
        }

        h1,
        label,
        p {
            color: #f1f1f1;
        }

        .form-control,
        .form-select,
        textarea {
            background-color: #ffffffcc;
            border: none;
            color: #000;
        }

        footer {
            background-color: rgba(0, 0, 0, 0.7);
            color: #ffffff;
        }

        .btn-custom {
            background-color: #3e0fe9;
            color: white;
            border: none;
        }

        .btn-custom:hover {
            background-color: #218838;
        }

        .navbar {
            background-color: #e04a0f;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark bg-gradient">
        <div class="container">
            <a class="navbar-brand" href="paginaprincipal.html">Encuestas</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <button class="btn btn-warning my-3" onclick="toggleEncuesta()">Activar/Desactivar Encuesta</button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="formcrearenquisa.html"> Sobre Nosotros </a></li>
                    <li class="nav-item"><a class="nav-link" href="formlogin.html"> Regístrate </a></li>
                    <li class="nav-item"><a class="nav-link" href="formpreguntas.html"> Servicios </a></li>
                    <li class="nav-item"><a class="nav-link" href="formrexistrousuarios.html"> Usuarios </a></li>
                    <li class="nav-item"><a class="nav-link" href="formularioderesposta.html"> Categorías </a></li>
                </ul>
            </div>
        </div>
    </nav>

    <script>
        function toggleEncuesta() {
            const overlay = document.querySelector('.overlay');
            overlay.style.display = (overlay.style.display === 'none' || overlay.style.display === '') ? 'block' : 'none';
        };

    </script>

    <div class="container my-5">
        <div class="overlay">
            <h1 class="mb-4">Encuesta sobre Hábitos de Consumo</h1>
            <p class="mb-4">Tus respuestas son valiosas y nos permitirán mejorar nuestros servicios para adaptarnos
                mejor a tus necesidades.</p>

            <form>
                <div class="mb-3">
                    <label for="frecuenciaCompras" class="form-label">¿Con qué frecuencia realizas tus compras?</label>
                    <input type="text" class="form-control" id="frecuenciaCompras" name="frecuencia_compras"
                        placeholder="Con frecuencia">
                </div>

                <div class="mb-3">
                    <label class="form-label">¿Dónde compra la mayoría de los productos que utiliza?</label>
                    <select class="form-select" name="lugar_compra" required>
                        <option disabled selected>Selecciona una opción</option>
                        <option>En tiendas oficiales</option>
                        <option>Online</option>
                        <option>Supermercados</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">¿Le recomendaría nuestro producto/servicios a otros clientes?</label><br>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="recomienda" id="apoyoSi" value="Sí" required>
                        <label class="form-check-label" for="apoyoSi">Sí</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="recomienda" id="apoyoNo" value="No">
                        <label class="form-check-label" for="apoyoNo">No</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="recomienda" id="apoyoNoSe" value="No sé">
                        <label class="form-check-label" for="apoyoNoSe">No sé</label>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">¿Cómo calificarías la atención recibida?</label>
                    <select class="form-select" name="calificacion_atencion" required>
                        <option disabled selected>Selecciona una opción</option>
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">¿Qué métodos de pago prefiere?</label>
                    <select class="form-select" name="metodo_pago" required>
                        <option disabled selected>Selecciona una opción</option>
                        <option>Tarjeta de crédito</option>
                        <option>Transferencia bancaria</option>
                        <option>PayPal</option>
                        <option>Efectivo</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">¿Qué factores influyen en sus decisiones de compra?</label>
                    <select class="form-select" name="factores_decision" required>
                        <option disabled selected>Selecciona una opción</option>
                        <option>Precio</option>
                        <option>Calidad</option>
                        <option>Recomendaciones</option>
                        <option>Marca</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">¿Sabías qué productos o servicios estás consumiendo y por qué los
                        eliges?</label>
                    <textarea class="form-control" name="razon_consumo" rows="2"
                        placeholder="Danos tu opinión..."></textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label">¿Cómo calificarías la presentación del producto o servicio?</label>
                    <select class="form-select" name="presentacion_producto" required>
                        <option disabled selected>Selecciona una opción</option>
                        <option value="mui mala">1</option>
                        <option value="mala">2</option>
                        <option value="regular">3</option>
                        <option value="ben">4</option>
                        <option value="excelente">5</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="ea">¿Cómo fue tu relación con otros consumidores o usuarios?</label>
                    <select name="relacion_con_otros" id="ea" class="form-select" required>
                        <option disabled selected>Selecciona una opción</option>
                        <option value="mui mala">1</option>
                        <option value="mala">2</option>
                        <option value="regular">3</option>
                        <option value="ben">4</option>
                        <option value="excelente">5</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">¿Tienes algún comentario adicional?</label>
                    <textarea class="form-control" name="comentario_adicional" rows="2"
                        placeholder="Escribe tu opinión personal..."></textarea>
                </div>

                <button type="submit" class="btn btn-custom">Enviar respuestas</button>
            </form>
        </div>
    </div>
    <script>
        /* ───── CONFIGURACIÓN ▄▀▄▀▄▀ */
        const usuarioID = 1;               // TODO: substitúe polo ID real (p. ex. ausession)
        
        /* ───── RECOLLIDA E ENVÍO ▄▀▄▀▄▀ */
        document.querySelector("form").addEventListener("submit", async (e) => {
          e.preventDefault();
        
          const respostas = [];
        
          /* 1. Frecuencia de compras (texto libre) */
          respostas.push({
            pregunta_id   : document.getElementById("frecuenciaCompras").dataset.pid,
            texto_resposta: document.getElementById("frecuenciaCompras").value.trim()
          });
        
          /* 2. Lugar de compra (select) */
          const lugar = e.target.lugar_compra.value;
          respostas.push({
            pregunta_id   : e.target.lugar_compra.dataset.pid,
            opcion_id     : e.target.lugar_compra.selectedOptions[0].dataset.oid
          });
        
          /* 3. Recomenda (radio) */
          const reco = e.target.querySelector("input[name='recomienda']:checked");
          respostas.push({
            pregunta_id   : reco.dataset.pid,
            opcion_id     : reco.dataset.oid
          });
        
          /* 4-7. Demais selects */
          ["calificacion_atencion","metodo_pago","factores_decision",
           "presentacion_producto","relacion_con_otros"].forEach(name => {
            const sel = e.target[name];
            respostas.push({
              pregunta_id: sel.dataset.pid,
              opcion_id  : sel.selectedOptions[0].dataset.oid
            });
          });
        
          /* 8. Razón consumo (textarea) */
          respostas.push({
            pregunta_id   : e.target.razon_consumo.dataset.pid,
            texto_resposta: e.target.razon_consumo.value.trim()
          });
        
          /* 9. Comentario adicional (textarea) */
          respostas.push({
            pregunta_id   : e.target.comentario_adicional.dataset.pid,
            texto_resposta: e.target.comentario_adicional.value.trim()
          });
        
          /* ───── ENVÍO ───── */
          const resp = await fetch("guardar_respostas.php", {
            method : "POST",
            headers: { "Content-Type": "application/json" },
            body   : JSON.stringify({ usuario_id: usuarioID, respostas })
          });
        
          if (resp.ok) {
            alert("❌Erro gardando respostas");
            e.target.reset();
          } else{
            alert("✅ Grazas pola túa participación! ");
          }
        });
        </script>
        
</body>
    <footer class="text-center py-3">
        <p class="mb-0">© 2025 Encuestas Empresa – Todos los derechos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>